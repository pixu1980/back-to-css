<!-- @function In Depth: Practical patterns and advanced usage -->

<!-- @function primer -->
<section data-topic="functions" data-menu-title="@function primer">
  <h4><mark>@function</mark> encapsulates CSS logic</h4>
  <small balance>Define a named function with parameters and return a computed value. Reuse complex math or conditionals across the stylesheet.</small>
</section>
<section data-topic="functions" data-menu-title="@function primer">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          @function flux-glow($energy) {
            @return clamp(4px, $energy * 12px, 40px);
          }

          .flux-panel {
            box-shadow:
              0 0 flux-glow(attr(data-energy number, 0.5)) currentcolor;
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-fn-intro" data-era="future" data-speed="60" data-energy="0.8" style="--flux-speed: 60; --flux-energy: 0.8">
          <header>
            <span>flux-glow()</span>
            <output data-live-value-target="#demo-fn-intro" data-live-value="data-energy" data-live-format="gw"></output>
          </header>
          <div class="flux-radial" data-label="fn"></div>
        </article>
      </small>
      <div class="control-row">
        <label>
          Energy
          <input type="range" min="0.5" max="1.8" step="0.01" value="0.8" data-attr-slider-target="#demo-fn-intro" data-attr-name="data-energy" data-attr-style-var="--flux-energy" />
        </label>
      </div>
    </right>
  </comparison>
</section>

<!-- Math chain -->
<section data-topic="functions" data-menu-title="Math chain">
  <h4>Chain math inside <mark>@function</mark></h4>
  <small balance>Compose calc, clamp, min, max inside a function. Each step stays readable and the final expression is just one return.</small>
</section>
<section data-topic="functions" data-menu-title="Math chain">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          @function timeline-pos($percent, $track-length) {
            @return clamp(
              0%,
              calc($percent * $track-length / 100),
              $track-length
            );
          }

          .marker {
            left: timeline-pos(
              attr(data-percent number, 0), 100%
            );
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-fn-math" data-era="future" data-speed="60" data-energy="1.0" style="--flux-speed: 60; --flux-energy: 1">
          <header>
            <span>timeline-pos()</span>
            <output data-live-value-target="#demo-fn-math" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="math"></div>
        </article>
      </small>
      <div class="control-row">
        <label>
          Speed
          <input type="range" min="0" max="88" step="1" value="60" data-attr-slider-target="#demo-fn-math" data-attr-name="data-speed" data-attr-style-var="--flux-speed" />
        </label>
      </div>
    </right>
  </comparison>
</section>

<!-- @function + if() -->
<section data-topic="functions" data-menu-title="@function + if()">
  <h4>Combine <mark>@function</mark> with <mark>if()</mark></h4>
  <small balance>Return conditional values from functions to centralize branching logic in a single place.</small>
</section>
<section data-topic="functions" data-menu-title="@function + if()">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          @function phase-color($speed) {
            @return if($speed >= 88, #ff0099, 
              if($speed >= 60, #f5a623, #00f5ff)
            );
          }

          .flux-panel {
            border-color: phase-color(attr(data-speed number, 0));
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-fn-if" data-era="future" data-speed="40" data-energy="0.6" style="--flux-speed: 40; --flux-energy: 0.6">
          <header>
            <span>phase-color()</span>
            <output data-live-value-target="#demo-fn-if" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="phase"></div>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-fn-if" data-attr-name="data-speed" data-attr-value="40" data-attr-style-var="--flux-speed" data-attr-group="fn-if-speed" aria-pressed="true">
          Charging
        </button>
        <button type="button" data-attr-target="#demo-fn-if" data-attr-name="data-speed" data-attr-value="70" data-attr-style-var="--flux-speed" data-attr-group="fn-if-speed" aria-pressed="false">
          Warmup
        </button>
        <button type="button" data-attr-target="#demo-fn-if" data-attr-name="data-speed" data-attr-value="88" data-attr-style-var="--flux-speed" data-attr-group="fn-if-speed" aria-pressed="false">
          Jump
        </button>
      </div>
    </right>
  </comparison>
</section>

<!-- Timeline helpers -->
<section data-topic="functions" data-menu-title="Timeline helpers">
  <h4>Timeline helpers via <mark>@function</mark></h4>
  <small balance>Functions can return durations, delays, or animation settings based on element index.</small>
</section>
<section data-topic="functions" data-menu-title="Timeline helpers">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          @function stagger-delay($index, $base-delay) {
            @return calc($index * $base-delay);
          }

          .timeline-item {
            animation-delay: stagger-delay(
              sibling-index(), 0.15s
            );
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-fn-timeline" data-era="future" data-speed="88" data-energy="1.21" style="--flux-speed: 88; --flux-energy: 1.21">
          <header>
            <span>stagger-delay()</span>
            <output data-live-value-target="#demo-fn-timeline" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="stagger"></div>
        </article>
      </small>
      <div class="control-row">
        <button
          type="button"
          data-attr-target="#demo-fn-timeline"
          data-attr-name="data-speed"
          data-attr-value="60"
          data-attr-style-var="--flux-speed"
          data-attr-group="fn-timeline-speed"
          aria-pressed="false"
        >
          Cruise
        </button>
        <button
          type="button"
          data-attr-target="#demo-fn-timeline"
          data-attr-name="data-speed"
          data-attr-value="88"
          data-attr-style-var="--flux-speed"
          data-attr-group="fn-timeline-speed"
          aria-pressed="true"
        >
          Jump
        </button>
      </div>
    </right>
  </comparison>
</section>

<!-- Glow library -->
<section data-topic="functions" data-menu-title="Glow library">
  <h4>Glow library with <mark>@function</mark></h4>
  <small balance>Create layered glows by composing multiple returns. Energy drives intensity and blur.</small>
</section>
<section data-topic="functions" data-menu-title="Glow library">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          @function inner-glow($energy) {
            @return 0 0 calc($energy * 15px) rgba(0,245,255,0.3);
          }
          @function outer-glow($energy) {
            @return 0 0 calc($energy * 35px) rgba(255,0,153,0.25);
          }

          .flux-panel {
            box-shadow:
              inner-glow(attr(data-energy number,0.5)),
              outer-glow(attr(data-energy number,0.5));
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-fn-glow" data-era="future" data-speed="88" data-energy="1.0" style="--flux-speed: 88; --flux-energy: 1">
          <header>
            <span>Dual glow</span>
            <output data-live-value-target="#demo-fn-glow" data-live-value="data-energy" data-live-format="gw"></output>
          </header>
          <div class="flux-radial" data-label="glow"></div>
        </article>
      </small>
      <div class="control-row">
        <label>
          Energy
          <input type="range" min="0.5" max="1.8" step="0.01" value="1" data-attr-slider-target="#demo-fn-glow" data-attr-name="data-energy" data-attr-style-var="--flux-energy" />
        </label>
      </div>
    </right>
  </comparison>
</section>

<!-- Function sharing -->
<section data-topic="functions" data-menu-title="Function sharing">
  <h4>Share <mark>@function</mark> across files</h4>
  <small balance>Define functions in a base stylesheet and import them. Every component inherits the same logic.</small>
</section>
<section data-topic="functions" data-menu-title="Function sharing">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          /* _btf-functions.css */
          @function safe-energy($val) {
            @return clamp(0.5, $val, 1.8);
          }

          /* components/_flux.css */
          @import url('./_btf-functions.css');
          .flux-panel {
            --energy: safe-energy(attr(data-energy number,0.5));
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-fn-share" data-era="future" data-speed="88" data-energy="2.5" style="--flux-speed: 88; --flux-energy: 2.5">
          <header>
            <span>safe-energy()</span>
            <output data-live-value-target="#demo-fn-share" data-live-value="data-energy" data-live-format="gw"></output>
          </header>
          <div class="flux-radial" data-label="safe"></div>
          <p class="status">Clamped to 1.8 despite raw 2.5 attribute.</p>
        </article>
      </small>
      <div class="control-row">
        <label>
          Raw energy
          <input type="range" min="0" max="3" step="0.05" value="2.5" data-attr-slider-target="#demo-fn-share" data-attr-name="data-energy" data-attr-style-var="--flux-energy" />
        </label>
      </div>
    </right>
  </comparison>
</section>

<!-- Debugging functions -->
<section data-topic="functions" data-menu-title="Debugging functions">
  <h4>Debugging <mark>@function</mark></h4>
  <small balance>Inspect computed values in DevTools by isolating function output to a custom property.</small>
</section>
<section data-topic="functions" data-menu-title="Debugging functions">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .flux-panel {
            --debug-glow: flux-glow(attr(data-energy number,0.5));
            box-shadow: 0 0 var(--debug-glow) currentcolor;
          }
        </code></pre>
        <pre>
          <code data-trim class="hljs shell">
          /* DevTools shows:
           * --debug-glow: 18px;
           */
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-fn-debug" data-era="future" data-speed="88" data-energy="1.5" style="--flux-speed: 88; --flux-energy: 1.5">
          <header>
            <span>Debug mode</span>
            <output data-live-value-target="#demo-fn-debug" data-live-value="data-energy" data-live-format="gw"></output>
          </header>
          <div class="flux-radial" data-label="debug"></div>
        </article>
      </small>
      <div class="control-row">
        <label>
          Energy
          <input type="range" min="0.5" max="1.8" step="0.01" value="1.5" data-attr-slider-target="#demo-fn-debug" data-attr-name="data-energy" data-attr-style-var="--flux-energy" />
        </label>
      </div>
    </right>
  </comparison>
</section>
