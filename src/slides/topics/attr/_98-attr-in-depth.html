<!-- attr() In Depth: Practical patterns and advanced usage -->

<!-- Typed attr() as flux readout -->
<section data-topic="foundations" data-menu-title="Flux readout pattern">
  <h4>Typed <mark>attr()</mark> as the flux readout</h4>
  <small balance>HTML stays the single source of truth. Wire typed attr() to widgets and read real numbers, angles, or tokens straight from data-* attributes.</small>
</section>
<section data-topic="foundations" data-menu-title="Flux readout pattern">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
        <code data-trim data-line-numbers class="hljs html">
        &lt;div
          class="flux-card"
          data-era="past"
          data-speed="72"
          data-energy="1.21"&gt;
        &lt;/div&gt;
      </code></pre>
        <pre>
        <code data-trim data-line-numbers class="hljs css">
        .flux-card {
          --flux-speed: attr(data-speed number, 0);
          --flux-energy: attr(data-energy number, 0.5);
          --flux-era-hue: if(attr(data-era token) = future, 196, 28);
          box-shadow: 0 0 calc(var(--flux-energy) * 18px)
            hsl(var(--flux-era-hue) 90% 60%);
        }
      </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-typed-attr" data-era="past" data-speed="72" data-energy="1.21" style="--flux-speed: 72; --flux-energy: 1.21">
          <header>
            <span>Flux scope</span>
            <output data-live-value-target="#demo-typed-attr" data-live-value="data-era"></output>
          </header>
          <div class="flux-radial" data-label="speed"></div>
          <p class="status">Typed attributes feed the UI with unit safe values.</p>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-typed-attr" data-attr-name="data-era" data-attr-value="past" data-attr-group="era-demo-1" aria-pressed="true">1985</button>
        <button type="button" data-attr-target="#demo-typed-attr" data-attr-name="data-era" data-attr-value="future" data-attr-group="era-demo-1" aria-pressed="false">2015</button>
      </div>
    </right>
  </comparison>
</section>

<!-- Attribute bus pattern -->
<section data-topic="foundations" data-menu-title="Attribute bus">
  <h4>HTML attributes as a <mark>state bus</mark></h4>
  <small balance>Prefix attributes with a component namespace, keep values human readable, and let CSS subscribe without extra classes.</small>
</section>
<section data-topic="foundations" data-menu-title="Attribute bus">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
        <code data-trim data-line-numbers class="hljs html">
        &lt;section
          class="timeline"
          data-era="future"
          data-speed="88"
          data-energy="1.21"&gt;
          &lt;button data-era="past"&gt;1985&lt;/button&gt;
          &lt;button data-era="future"&gt;2015&lt;/button&gt;
        &lt;/section&gt;
      </code></pre>
        <pre>
        <code data-trim data-line-numbers class="hljs css">
        :where(.timeline) {
          --era: attr(data-era token, past);
          --speed: attr(data-speed number, 0);
        }

        .timeline button[data-era='future'] {
          border-color: hsl(196 100% 70%);
        }
      </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel" id="demo-attr-bus" data-era="past" data-speed="64" data-energy="0.88" style="--flux-speed: 64; --flux-energy: 0.88">
          <header>
            <span>Shared state</span>
            <output data-live-value-target="#demo-attr-bus" data-live-value="data-era"></output>
          </header>
          <ul class="contract-table" aria-label="Attribute contract">
            <li><span>data-era</span><span>past | future</span></li>
            <li><span>data-speed</span><span>number (mph)</span></li>
          </ul>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-attr-bus" data-attr-name="data-era" data-attr-value="past" data-attr-group="era-demo-2" aria-pressed="true">Past</button>
        <button type="button" data-attr-target="#demo-attr-bus" data-attr-name="data-era" data-attr-value="future" data-attr-group="era-demo-2" aria-pressed="false">Future</button>
      </div>
    </right>
  </comparison>
</section>

<!-- Unit safe calculations -->
<section data-topic="foundations" data-menu-title="Unit safe math">
  <h4>Unit safe <mark>calculations</mark></h4>
  <small balance>Attribute values remain typed, so we can feed calc(), min(), max(), or clamp() without guessing units.</small>
</section>
<section data-topic="foundations" data-menu-title="Unit safe math">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .timeline-console {
            --track-progress: calc(
              (attr(data-stop number, 1955) - 1955) * 1.666%
            );
          }

          .timeline-marker {
            transform: translateX(var(--track-progress));
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel timeline-console" id="demo-unit-safe" data-era="past" data-stop="1985" style="--timeline-offset: 49.8%">
          <header>
            <span>Temporal track</span>
            <output data-live-value-target="#demo-unit-safe" data-live-value="data-stop" data-live-format="year"></output>
          </header>
          <div class="timeline-track" aria-hidden="true">
            <div class="timeline-marker"></div>
          </div>
          <footer><span>1955</span><span>2015</span></footer>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-unit-safe" data-attr-name="data-stop" data-attr-value="1955" data-attr-group="timeline-demo" aria-pressed="false">1955</button>
        <button type="button" data-attr-target="#demo-unit-safe" data-attr-name="data-stop" data-attr-value="1985" data-attr-group="timeline-demo" aria-pressed="true">1985</button>
        <button type="button" data-attr-target="#demo-unit-safe" data-attr-name="data-stop" data-attr-value="2015" data-attr-group="timeline-demo" aria-pressed="false">2015</button>
      </div>
    </right>
  </comparison>
</section>

<!-- Bridge to custom properties -->
<section data-topic="foundations" data-menu-title="Bridge to vars">
  <h4>Bridge attributes to <mark>custom properties</mark></h4>
  <small balance>Mirror the value into a custom property so legacy browsers can keep rendering while modern engines pick it up with typed attr().</small>
</section>
<section data-topic="foundations" data-menu-title="Bridge to vars">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .flux-panel {
            --flux-speed: attr(data-speed number, var(--flux-speed, 0));
            --flux-energy: attr(data-energy number, var(--flux-energy, 1));
          }
        </code></pre>
        <pre>
          <code data-trim data-line-numbers class="hljs html">
          &lt;div
            class="flux-panel"
            data-speed="72"
            style="--flux-speed:72;"&gt;
          &lt;/div&gt;
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-attr-bridge" data-era="future" data-speed="72" data-energy="1.21" style="--flux-speed: 72; --flux-energy: 1.21">
          <header>
            <span>Bridge output</span>
            <output data-live-value-target="#demo-attr-bridge" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="bridge"></div>
          <p class="status">Fallback custom properties keep the paint predictable.</p>
        </article>
      </small>
      <div class="control-row">
        <label>
          Energy
          <input type="range" min="0.5" max="1.5" step="0.01" value="1.21" data-attr-slider-target="#demo-attr-bridge" data-attr-name="data-energy" data-attr-style-var="--flux-energy" />
        </label>
      </div>
    </right>
  </comparison>
</section>

<!-- Accessibility -->
<section data-topic="foundations" data-menu-title="Accessibility">
  <h4>Mirror attributes to <mark>accessibility</mark></h4>
  <small balance>When attributes are the truth, assistive tech can read the same stream. Mirror the value into aria-live and keep the UI inclusive.</small>
</section>
<section data-topic="foundations" data-menu-title="Accessibility">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs html">
          &lt;section
            class="flux-panel"
            data-era="future"
            aria-live="polite"
            aria-label="Flux mode future"&gt;
          &lt;/section&gt;
        </code></pre>
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .flux-panel::before {
            content: attr(data-era);
          }

          @media (prefers-reduced-motion: reduce) {
            .flux-radial { animation: none; }
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-attr-a11y" data-era="future" data-speed="88" aria-live="polite" style="--flux-speed: 88; --flux-energy: 1.21">
          <header>
            <span>Accessible mode</span>
            <output data-live-value-target="#demo-attr-a11y" data-live-value="data-era"></output>
          </header>
          <div class="flux-radial" data-label="a11y"></div>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-attr-a11y" data-attr-name="data-era" data-attr-value="future" data-attr-group="era-demo-4" aria-pressed="true">Future</button>
        <button type="button" data-attr-target="#demo-attr-a11y" data-attr-name="data-era" data-attr-value="past" data-attr-group="era-demo-4" aria-pressed="false">Past</button>
      </div>
    </right>
  </comparison>
</section>

<!-- Debugging -->
<section data-topic="foundations" data-menu-title="Debugging">
  <h4>Debug attribute <mark>pipelines</mark></h4>
  <small balance>Log attributes with content: attr(), expose them inside DevTools, and turn on a debug overlay while building temporal widgets.</small>
</section>
<section data-topic="foundations" data-menu-title="Debugging">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .flux-panel[data-debug='on']::before {
            content: attr(data-era) ' - '
                    attr(data-speed) ' mph';
          }
        </code></pre>
        <pre>
          <code data-trim data-line-numbers class="hljs html">
          &lt;div
            class="flux-panel"
            data-era="past"
            data-speed="70"
            data-debug="on"&gt;
          &lt;/div&gt;
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-attr-debug" data-era="past" data-speed="70" data-energy="0.92" data-debug="off" style="--flux-speed: 70; --flux-energy: 0.92">
          <header>
            <span>Debug overlay</span>
            <output data-live-value-target="#demo-attr-debug" data-live-value="data-debug"></output>
          </header>
          <div class="flux-radial" data-label="debug"></div>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-attr-debug" data-attr-name="data-debug" data-attr-value="on" data-attr-group="debug-toggle" aria-pressed="false">Debug on</button>
        <button type="button" data-attr-target="#demo-attr-debug" data-attr-name="data-debug" data-attr-value="off" data-attr-group="debug-toggle" aria-pressed="true">Debug off</button>
      </div>
    </right>
  </comparison>
</section>
