<!-- if() In Depth: Practical patterns and advanced usage -->

<!-- if() primer -->
<section data-topic="branching" data-menu-title="if() primer">
  <h4>Native <mark>if()</mark> brings logic to CSS</h4>
  <small balance>The ternary syntax moves into CSS so we can branch on numbers, tokens, or booleans directly in the cascade.</small>
</section>
<section data-topic="branching" data-menu-title="if() primer">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .flux-panel {
            --status-hue: if(attr(data-speed number, 0) >= 88, 140, 28);
            box-shadow: 0 0 25px hsl(var(--status-hue) 80% 60%);
          }

          .flux-panel .status::after {
            content: if(
              attr(data-speed number, 0) >= 88,
              'Jump ready',
              'Charging'
            );
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-if-intro" data-era="future" data-speed="60" data-energy="1.21" style="--flux-speed: 60; --flux-energy: 1.21">
          <header>
            <span>if() status</span>
            <output data-live-value-target="#demo-if-intro" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="if"></div>
          <p class="status">CSS decides when to shout "Jump ready".</p>
        </article>
      </small>
      <div class="control-row">
        <button
          type="button"
          data-attr-target="#demo-if-intro"
          data-attr-name="data-speed"
          data-attr-value="60"
          data-attr-style-var="--flux-speed"
          data-attr-group="if-intro-speed"
          aria-pressed="true"
        >
          60 mph
        </button>
        <button
          type="button"
          data-attr-target="#demo-if-intro"
          data-attr-name="data-speed"
          data-attr-value="88"
          data-attr-style-var="--flux-speed"
          data-attr-group="if-intro-speed"
          aria-pressed="false"
        >
          88 mph
        </button>
      </div>
    </right>
  </comparison>
</section>

<!-- if() vs classes -->
<section data-topic="branching" data-menu-title="if() vs classes">
  <h4><mark>if()</mark> replaces helper classes</h4>
  <small balance>Instead of flipping .is-active everywhere, evaluate the condition once. The CSS cascade handles the rest.</small>
</section>
<section data-topic="branching" data-menu-title="if() vs classes">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs js">// before
          button.addEventListener('click', () => {
            panel.classList.toggle('is-critical', speed >= 88);
          });
        </code></pre>
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .flux-panel {
            --glow-alpha: if(attr(data-speed number, 0) >= 88, 0.7, 0.25);
            box-shadow: 0 0 35px rgba(0, 245, 255, var(--glow-alpha));
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-if-vs-classes" data-era="future" data-speed="70" data-energy="1.05" style="--flux-speed: 70; --flux-energy: 1.05">
          <header>
            <span>Classless diff</span>
            <output data-live-value-target="#demo-if-vs-classes" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="logic"></div>
        </article>
      </small>
      <div class="control-row">
        <button
          type="button"
          data-attr-target="#demo-if-vs-classes"
          data-attr-name="data-speed"
          data-attr-value="70"
          data-attr-style-var="--flux-speed"
          data-attr-group="if-class-speed"
          aria-pressed="true"
        >
          Nominal
        </button>
        <button
          type="button"
          data-attr-target="#demo-if-vs-classes"
          data-attr-name="data-speed"
          data-attr-value="88"
          data-attr-style-var="--flux-speed"
          data-attr-group="if-class-speed"
          aria-pressed="false"
        >
          Jump
        </button>
      </div>
    </right>
  </comparison>
</section>

<!-- Multi condition -->
<section data-topic="branching" data-menu-title="Multi condition">
  <h4>Chain <mark>if()</mark> for multi step logic</h4>
  <small balance>Combine conditions to create tiers: charging, warmup, and jump ready. The CSS stays declarative.</small>
</section>
<section data-topic="branching" data-menu-title="Multi condition">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          @property --flux-phase {
            syntax: '&lt;integer&gt;';
            inherits: false;
            initial-value: 0;
          }

          .flux-panel {
            --flux-phase: if(attr(data-speed number, 0) >= 88, 2,
              if(attr(data-speed number, 0) >= 60, 1, 0)
            );
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-if-multicondition" data-era="future" data-speed="40" data-energy="0.6" style="--flux-speed: 40; --flux-energy: 0.6">
          <header>
            <span>Phase tiers</span>
            <output data-live-value-target="#demo-if-multicondition" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="tiers"></div>
        </article>
      </small>
      <div class="control-row">
        <button
          type="button"
          data-attr-target="#demo-if-multicondition"
          data-attr-name="data-speed"
          data-attr-value="40"
          data-attr-style-var="--flux-speed"
          data-attr-group="if-multi"
          aria-pressed="true"
        >
          Charging
        </button>
        <button
          type="button"
          data-attr-target="#demo-if-multicondition"
          data-attr-name="data-speed"
          data-attr-value="70"
          data-attr-style-var="--flux-speed"
          data-attr-group="if-multi"
          aria-pressed="false"
        >
          Warmup
        </button>
        <button
          type="button"
          data-attr-target="#demo-if-multicondition"
          data-attr-name="data-speed"
          data-attr-value="88"
          data-attr-style-var="--flux-speed"
          data-attr-group="if-multi"
          aria-pressed="false"
        >
          Jump
        </button>
      </div>
    </right>
  </comparison>
</section>

<!-- Range checks -->
<section data-topic="branching" data-menu-title="Range checks">
  <h4>Range checks with <mark>if()</mark> + math</h4>
  <small balance>Use math functions to sanitize input before if() evaluates it. Energy spikes stay inside safe ranges.</small>
</section>
<section data-topic="branching" data-menu-title="Range checks">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .flux-panel {
            --energy: clamp(0.5, attr(data-energy number, 0.5), 1.8);
            --alert-color: if(var(--energy) >= 1.21, #ff0066, #00f5ff);
          }
            
          .flux-panel .status {
            border-left-color: var(--alert-color);
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-if-range" data-era="future" data-speed="75" data-energy="1.0" style="--flux-speed: 75; --flux-energy: 1">
          <header>
            <span>Range guard</span>
            <output data-live-value-target="#demo-if-range" data-live-value="data-energy" data-live-format="gw"></output>
          </header>
          <div class="flux-radial" data-label="range"></div>
        </article>
      </small>
      <div class="control-row">
        <label>
          Energy
          <input type="range" min="0.5" max="1.8" step="0.01" value="1.0" data-attr-slider-target="#demo-if-range" data-attr-name="data-energy" data-attr-style-var="--flux-energy" />
        </label>
      </div>
    </right>
  </comparison>
</section>

<!-- Accessibility -->
<section data-topic="branching" data-menu-title="Accessibility">
  <h4>Accessibility with <mark>if()</mark></h4>
  <small balance>Combine if() with custom properties set from media queries to honor reduced motion.</small>
</section>
<section data-topic="branching" data-menu-title="Accessibility">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          .flux-panel::after {
            content: if(
              attr(data-speed number, 0) >= 88,
              'Announce: jump imminent',
              'Announce: charging'
            );
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-if-a11y" data-era="future" data-speed="60" data-energy="1.0" style="--flux-speed: 60; --flux-energy: 1">
          <header>
            <span>Announcement</span>
            <output data-live-value-target="#demo-if-a11y" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="a11y"></div>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-if-a11y" data-attr-name="data-speed" data-attr-value="60" data-attr-style-var="--flux-speed" data-attr-group="if-a11y" aria-pressed="true">
          Charging
        </button>
        <button type="button" data-attr-target="#demo-if-a11y" data-attr-name="data-speed" data-attr-value="88" data-attr-style-var="--flux-speed" data-attr-group="if-a11y" aria-pressed="false">
          Jump ready
        </button>
      </div>
    </right>
  </comparison>
</section>

<!-- Performance -->
<section data-topic="branching" data-menu-title="Performance">
  <h4>Performance profile of <mark>if()</mark></h4>
  <small balance>if() resolves at computed value time, so it is free at runtime. Browsers skip the branches that do not apply.</small>
</section>
<section data-topic="branching" data-menu-title="Performance">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          @property --is-critical {
            syntax: '&lt;integer&gt;';
            inherits: false;
            initial-value: 0;
          }

          .flux-panel {
            --is-critical: if(attr(data-speed number, 0) >= 88, 1, 0);
            box-shadow: 0 0 calc(15px + var(--is-critical) * 20px)
              rgba(255, 0, 153, 0.4);
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-if-perf" data-era="future" data-speed="88" data-energy="1.21" style="--flux-speed: 88; --flux-energy: 1.21">
          <header>
            <span>Memoized check</span>
            <output data-live-value-target="#demo-if-perf" data-live-value="data-speed" data-live-format="mph"></output>
          </header>
          <div class="flux-radial" data-label="memo"></div>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-if-perf" data-attr-name="data-speed" data-attr-value="70" data-attr-style-var="--flux-speed" data-attr-group="if-perf" aria-pressed="false">
          Cruise
        </button>
        <button type="button" data-attr-target="#demo-if-perf" data-attr-name="data-speed" data-attr-value="88" data-attr-style-var="--flux-speed" data-attr-group="if-perf" aria-pressed="true">
          Jump
        </button>
      </div>
    </right>
  </comparison>
</section>

<!-- Fallbacks -->
<section data-topic="branching" data-menu-title="Fallbacks">
  <h4>Plan <mark>fallbacks</mark> for if()</h4>
  <small balance>Wrap experimental logic with @supports so legacy browsers still render. The HTML attributes stay the same.</small>
</section>
<section data-topic="branching" data-menu-title="Fallbacks">
  <comparison>
    <left>
      <article class="code-stack">
        <pre>
          <code data-trim data-line-numbers class="hljs css">
          @supports (opacity: if(1 > 0, 1, 0)) {
            .flux-panel {
              opacity: if(attr(data-era token) = past, 0.85, 1);
            }
          }

          @supports not (opacity: if(1 > 0, 1, 0)) {
            .flux-panel[data-era='past'] {
              opacity: 0.85;
            }
          }
        </code></pre>
      </article>
    </left>
    <right>
      <small>
        <article class="demo-panel flux-panel" id="demo-fallback" data-era="past" data-speed="40" data-energy="0.7" style="--flux-speed: 40; --flux-energy: 0.7">
          <header>
            <span>Fallback path</span>
            <output data-live-value-target="#demo-fallback" data-live-value="data-era"></output>
          </header>
          <div class="flux-radial" data-label="fallback"></div>
        </article>
      </small>
      <div class="control-row">
        <button type="button" data-attr-target="#demo-fallback" data-attr-name="data-era" data-attr-value="past" data-attr-group="if-fallback" aria-pressed="true">Past</button>
        <button type="button" data-attr-target="#demo-fallback" data-attr-name="data-era" data-attr-value="future" data-attr-group="if-fallback" aria-pressed="false">Future</button>
      </div>
    </right>
  </comparison>
</section>
